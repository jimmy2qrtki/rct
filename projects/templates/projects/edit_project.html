<!-- templates/projects/edit_project.html -->
<!DOCTYPE html>
<html lang="ru_RU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Правка - {{ project.name }}</title>
    {% load static %}
    <!-- <link rel="stylesheet" href="{% static 'css/1.12.1-jquery-ui.css' %}"> -->
    <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/edit-project.css' %}">
    <script type="text/javascript">
        const DJANGO_DATA = {
            urls: {
                createEvent: "{% url 'create_event' project_id=project.id %}",
                getRemainingRequests: "{% url 'get_remaining_requests' %}",
                getCoordinates: "{% url 'get_coordinates' project.id %}",
                updateAddresses: "{% url 'update_addresses' project.id %}",
                deleteAddresses: "{% url 'delete_addresses' project.id %}",
                updateAddressOrder: "{% url 'update_address_order' %}",
                editAddressName: "{% url 'edit_address_name' project.id %}",
                deleteAddress: "{% url 'delete_address' project.id %}",
            },
            csrfToken: "{{ csrf_token }}",
            secondsUntilMidnight: '{{ seconds_until_midnight }}',
            apiKey: "{{ user.profile.api_key }}",
        };
    </script>
    <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
    <!-- <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->
    <script src="{% static 'js/jquery-ui.1.12.1.min.js' %}"></script>
    <script src="https://api-maps.yandex.ru/2.1/?apikey={{ api_key }}&lang=ru_RU" type="text/javascript"></script>
    <script src="{% static 'js/edit_project.js' %}" defer></script>
    
</head>
<body class="page project">
    <header class="page__header">
        <nav class="nav">
            <ul class="nav__list">
                <li class="nav__item">
                    <a class="nav__link nav__link--inactive" href="{% url 'profile' %}">Профиль</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link nav__link--active">Проекты</a>
                </li>
                <li class="nav__item">
                    <a class="nav__link nav__link--inactive" href="{% url 'events_control' %}">Контроль</a>
                </li>
            </ul>
        </nav>
        <div class="logo">
            <img class="logo__img" src="{% static 'img/logo.png' %}" alt="Логотип">
        </div>
    </header>
    <div class="container">
        <div class="project__header">
            <h1 class="page__title">{{ project.name }}</h1>
            <ul class="bread-crumbs">
                <li class="bread-crumbs__item">
                    <a class="bread-crumbs__link" href="{% url 'manage_projects' %}">Проекты</a>
                </li>
            </ul>
            <button class="project__save-btn btn" type="button" id="save-project-button">Сохранить проект</button>
            <a class="project__close-btn" href="{% url 'manage_projects' %}"></a>
        </div>
        <div class="project__content">
            <div class="project__content-row">
                <div class="project__content-col">
                    <div class="project__content-cell" data-section-id="details">
                        <div class="project__cell-header" data-section-id="details">
                            <h2 class="page__block-title">Детали</h2>
                        </div>
                        <div class="project__cell-content" data-section-id="details">
                            <div class="project__cell-content-wrap">
                                <form class="project__form" id="project-form" method="POST" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="project__form-field">
                                        <label for="{{ form.name.id_for_label }}">Название</label>
                                        {{ form.name }}
                                    </div>
                                    <div class="project__form-field">
                                        <label for="{{ form.organization.id_for_label }}">Организация взаимодействия</label>
                                        {{ form.organization }}
                                    </div>
                                    <div class="project__form-field" id="new-organization-field" style="display: none;">
                                        <label for="{{ form.new_organization.id_for_label }}">Новая организация</label>
                                        {{ form.new_organization }}
                                    </div>
                                    <div class="project__form-field">
                                        <label for="{{ form.product.id_for_label }}">Продукция взаимодействия</label>
                                        {{ form.product }}
                                    </div>
                                    <div class="project__form-field">
                                        <label for="{{ form.description.id_for_label }}">Описание</label>
                                        {{ form.description }}
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="project__content-cell" data-section-id="events">
                        <div class="project__cell-header" data-section-id="events">
                            <h2 class="page__block-title">События</h2>
                        </div>
                        <div class="project__cell-content" data-section-id="events">
                            <div class="project__cell-content-wrap">
                                <ul class="project__events-list">
                                    {% for event in events %}
                                    <li class="project__events-item">
                                        <a class="project__events-link" href="{% url 'edit_event' event.id %}">
                                            {{ event.get_event_type_display }} {{ event.event_date }}
                                        </a>
                                        <span class="project__events-status">{{ event.get_status_display }}</span>
                                        <form class="project__events-delete-form" method="POST" action="{% url 'delete_event' event.id %}" style="display:inline;">
                                            {% csrf_token %}
                                            <button class="project__events-delete-btn btn" type="submit" onclick="return confirm('Вы уверены что хотите удалить событие?');">Удалить</button>
                                        </form>
                                    </li>
                                    {% empty %}
                                    <li class="project__events-item no-addresses">Нет событий</li>
                                    {% endfor %}
                                </ul>
                                <button class="project__create-event-btn btn" id="create-event-btn">Создать</button>
                            </div>
                        </div>
                    </div>
                    <div class="project__content-cell" data-section-id="addresses">
                        <div class="project__cell-header" data-section-id="addresses">
                            <h2 class="page__block-title">Адреса</h2>
                        </div>
                        <div class="project__cell-content" data-section-id="addresses">
                            <div class="project__cell-content-wrap">
                                <div class="file-upload">
                                    <div class="file-upload-wrap">
                                        <div class="file-upload-choice">
                                            <button type="button" class="file-button">Excel файл</button>
                                            <input type="file" id="id_excel_file" style="display: none;">
                                            <span class="file-name">не выбран</span>
                                        </div>
                                        <button class="get-coordinates-btn btn" type="button" id="get-coordinates-btn">Добавить адреса</button>
                                    </div>
                                    <span class="remaining-requests" id="remaining-requests">{{ remaining_requests }}</span>
                                </div>
                                <div class="loading-indicator" id="loading-indicator" style="display: none;">Идет парсинг адресов, пожалуйста подождите...</div>
                                <ul class="project__addresses-list" id="addresses-list">
                                    {% for address in addresses %}
                                    <li class="project__addresses-item" data-id="{{ address.id }}">
                                        <span class="address-number">={{ forloop.counter }}=</span>
                                        <input class="address-name" value="{{ address.name }}" data-id="{{ address.id }}">
                                        <div class="hidden-coordinates">
                                            <span class="latitude">{{ address.latitude }}</span> | 
                                            <span class="longitude">{{ address.longitude }}</span>
                                        </div>
                                        <button class="delete-address-btn btn" data-id="{{ address.id }}">Удалить</button>
                                    </li>
                                    {% empty %}
                                    <li class="project__addresses-item no-addresses">Нет адресов</li>
                                    {% endfor %}
                                </ul>
                                <div class="project__addresses-list-btns">
                                    <div class="project__addresses-list-btns-wrap">
                                        <button class="add-address-btn btn" type="button" id="add-address-btn">Добавить адрес</button>
                                        <button class="update-addresses-btn btn" type="button" id="update-addresses-btn">Обновить список</button>
                                    </div>
                                    <button class="delete-addresses-btn btn" type="button" id="delete-addresses-btn">Удалить список</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="project__content-col">
                    <div class="map-wrap">
                        <div id="map" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Модальное окно -->
        <div id="create-event-modal" class="modal">
            <div class="modal-content">
                <div class="modal-content__header">
                    <h2 class="page__modal-title">Создать событие</h2>
                    <span class="modal-close-btn"></span>
                </div>
                <form class="create-event__form" id="create-event-form" method="post">
                    {% csrf_token %}
                    <div>
                        <div class="create-event__field">
                            <label for="id_event_type">Событие</label>
                            {{ event_form.event_type }}
                        </div>

                        <div class="create-event__field">
                            <label for="id_photo_count">Кол-во фото</label>
                            {{ event_form.photo_count }}
                        </div>

                        <div class="create-event__field">
                            <label for="id_event_date">Дата начала</label>
                            <div class="create-event__field-wrap">
                                {{ event_form.event_date }}
                            </div>
                        </div>
                
                        <div class="create-event__field">
                            <label for="id_duration_days">Срок выполнения (в днях)</label>
                            {{ event_form.duration_days }}
                        </div>
                
                        <div class="create-event__field">
                            <label for="id_description">Описание</label>
                            {{ event_form.description }}
                        </div>
                    </div>
                    <button class="create-event__btn btn" type="submit">Далее</button>
                </form>
            </div>
        </div>
        
    </div>

    
</body>
<footer class="page__footer">

</footer>
</html>