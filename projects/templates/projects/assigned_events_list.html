 <!-- templates/projects/assigned_events_list.html -->
 <html>
 <head>
    <title>Назначенные события</title>
    {% load static %}
    <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
 </head>
 <body>
    <a href="{% url 'executor_profile' %}">Профиль</a>
    <h2>Назначенные события</h2>

    <table>
        <thead>
            <tr>
                <th>Название проекта</th>
                <th>Организация</th>
                <th>Продукция</th>
                <th>Дата начала</th>
                <th>Дедлайн</th>
                <th>Количество адресов</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for event in assigned_events %}
            <tr>
                <td>{{ event.project.name }}</td>
                <td>{{ event.project.organization }}</td>
                <td>{{ event.project.product }}</td>
                <td>{{ event.event_date|date:"Y-m-d" }}</td>
                <td>{{ event.due_date|date:"Y-m-d" }}</td>
                <td>{{ event.addresses.count }}</td>
                <td>
                    {% for event_user in event.eventuser_set.all %}
                        {% if event_user.user == request.user %}
                            <button type="button" class="confirm-btn" data-event-id="{{ event.id }}" data-user-id="{{ request.user.id }}">Подтвердить</button>
                        {% endif %}
                    {% endfor %}
                    <form action="{% url 'event_remove' event.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit">Удалить</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">Нет назначенных событий.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        $(document).on('click', '.confirm-btn', function() {
            var event_id = $(this).data('event-id');
            var user_id = $(this).data('user-id');
            
            $.ajax({
                url: "{% url 'confirm_executor' %}",
                method: "POST",
                data: {
                    event_id: event_id,
                    user_id: user_id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.success) {
                        location.reload();
                    } else {
                        alert('Ошибка: ' + response.error);
                    }
                }
            });
        });
    </script>
</body>
</html>